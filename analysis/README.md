# Analysis

Jupyter notebooks for analyzing the results produced by PrivLess and its companion tools. The notebooks generate figures and statistics used in the research paper.

## Prerequisites

Before running any notebook, the following steps must be completed in order:

### 1. Run the PrivLess pipeline

Analyze serverless apps for each language to generate usage-based policies and statistics.

```bash
cd src
python privLess.py --language javascript --apps-json ../apps_javascript.json
python privLess.py --language python --apps-json ../apps_python.json
python privLess.py --language go --apps-json ../apps_go.json
```

This populates `output/results/stats/<language>/` with `analysis_stats.jsonl` and `analysis_stats-time.csv`.

### 2. Run the Default Policy Analyzer

Extract IAM policies declared in each app's `serverless.yml` for comparison against PrivLess output.

```bash
python tools/default_policy_analyzer/privLess_default_policy_analyzer.py \
  --language javascript --apps-json apps_javascript.json

python tools/default_policy_analyzer/privLess_default_policy_analyzer.py \
  --language python --apps-json apps_python.json

python tools/default_policy_analyzer/privLess_default_policy_analyzer.py \
  --language go --apps-json apps_go.json
```

This populates `output/results/default_policy_analysis/` with per-language JSONL files.

### 3. Run the Permission Classifier

Classify each app's declared permissions into security impact categories.

```bash
python tools/permission_classifier/permission_classifier.py --apps-json apps.json
```

This writes `output/results/permission_classifications/permission_classifications.csv`.

### 4. Combine results across languages

Merge the per-language output files into single combined files that the notebooks load.

```bash
python tools/combine_results.py
```

This produces:

| Combined file | Source |
|---|---|
| `output/results/default_policy_analysis/combined_default_policy_stats.jsonl` | All `default_policy_stats_*.jsonl` |
| `output/results/stats/combined_analysis_stats.jsonl` | All `stats/*/analysis_stats.jsonl` |
| `output/results/stats/combined_analysis_stats-time.csv` | All `stats/*/analysis_stats-time.csv` |

## Notebook overview

### [default/](default/) — Default policy analysis

Analyzes the IAM policies that developers originally declared in their `serverless.yml` files.

- **policy_analysis.ipynb** — Policy structure, wildcard usage, service distribution, dangerous permissions
- **permission_classification.ipynb** — Security impact classification of declared permissions

### [privLess/](privLess/) — PrivLess output analysis

Analyzes the policies generated by the PrivLess pipeline and compares them against defaults to quantify over-privilege.

- **runtime_analysis.ipynb** — Pipeline runtime performance (CodeQL DB creation, query times, analysis time)
- **privLess_policy_analysis.ipynb** — Side-by-side comparison of default vs PrivLess policies, over-privilege ratios

## Python dependencies

The notebooks require:

```
jupyter
pandas
numpy
matplotlib
seaborn
```

These are included in the project's `requirements.txt`.
